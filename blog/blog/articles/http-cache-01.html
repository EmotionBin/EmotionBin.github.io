<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端也要懂HTTP缓存机制 | 黄伟斌的博客</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/blog/img/avatar.jpg">
    <link rel="stylesheet" href="/blog/css/style.css">
    <meta name="description" content="冲冲冲，淦就完事了">
    
    <link rel="preload" href="/blog/assets/css/0.styles.692e8817.css" as="style"><link rel="preload" href="/blog/assets/js/app.591f29a6.js" as="script"><link rel="preload" href="/blog/assets/js/2.74b5bf19.js" as="script"><link rel="preload" href="/blog/assets/js/18.24ff51a2.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.7e1fdfb6.js"><link rel="prefetch" href="/blog/assets/js/11.ee15db76.js"><link rel="prefetch" href="/blog/assets/js/12.ff13d895.js"><link rel="prefetch" href="/blog/assets/js/13.a86cacb0.js"><link rel="prefetch" href="/blog/assets/js/14.20f4410c.js"><link rel="prefetch" href="/blog/assets/js/15.fd7bc913.js"><link rel="prefetch" href="/blog/assets/js/16.d29100a0.js"><link rel="prefetch" href="/blog/assets/js/17.f783ac42.js"><link rel="prefetch" href="/blog/assets/js/19.f772d37b.js"><link rel="prefetch" href="/blog/assets/js/20.8e245c68.js"><link rel="prefetch" href="/blog/assets/js/21.8768638a.js"><link rel="prefetch" href="/blog/assets/js/22.ae53d9af.js"><link rel="prefetch" href="/blog/assets/js/23.cf93a7ec.js"><link rel="prefetch" href="/blog/assets/js/24.44c62c5e.js"><link rel="prefetch" href="/blog/assets/js/25.a8281169.js"><link rel="prefetch" href="/blog/assets/js/26.081685f9.js"><link rel="prefetch" href="/blog/assets/js/27.e18ab845.js"><link rel="prefetch" href="/blog/assets/js/28.fdacc25e.js"><link rel="prefetch" href="/blog/assets/js/29.3953f445.js"><link rel="prefetch" href="/blog/assets/js/3.de469ec9.js"><link rel="prefetch" href="/blog/assets/js/30.b6f4af04.js"><link rel="prefetch" href="/blog/assets/js/31.149d04e4.js"><link rel="prefetch" href="/blog/assets/js/32.3155fa66.js"><link rel="prefetch" href="/blog/assets/js/33.ab888173.js"><link rel="prefetch" href="/blog/assets/js/34.07c33e01.js"><link rel="prefetch" href="/blog/assets/js/35.905793b4.js"><link rel="prefetch" href="/blog/assets/js/36.d992e138.js"><link rel="prefetch" href="/blog/assets/js/4.44773bdf.js"><link rel="prefetch" href="/blog/assets/js/5.94131642.js"><link rel="prefetch" href="/blog/assets/js/6.22294c7e.js"><link rel="prefetch" href="/blog/assets/js/7.96080206.js"><link rel="prefetch" href="/blog/assets/js/8.9e81c0f3.js"><link rel="prefetch" href="/blog/assets/js/9.0d88fb32.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.692e8817.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">黄伟斌的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/blog/blog/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具箱" class="dropdown-title"><span class="title">工具箱</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具箱" class="mobile-dropdown-title"><span class="title">工具箱</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          在线编辑
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://tinypng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  图片压缩
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          在线服务
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.aliyun.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阿里云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cloud.tencent.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  腾讯云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          博客指南
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://juejin.im/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://blog.csdn.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/EmotionBin/vue-press-blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/blog/blog/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具箱" class="dropdown-title"><span class="title">工具箱</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具箱" class="mobile-dropdown-title"><span class="title">工具箱</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          在线编辑
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://tinypng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  图片压缩
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          在线服务
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.aliyun.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阿里云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cloud.tencent.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  腾讯云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          博客指南
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://juejin.im/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://blog.csdn.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/EmotionBin/vue-press-blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Javascript基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端琐事</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>跨端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>网络</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/blog/articles/http-cache-01.html" aria-current="page" class="active sidebar-link">前端也要懂HTTP缓存机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/blog/articles/http-cache-01.html#http简介" class="sidebar-link">Http简介</a></li><li class="sidebar-sub-header"><a href="/blog/blog/articles/http-cache-01.html#后台搭建与测试" class="sidebar-link">后台搭建与测试</a></li><li class="sidebar-sub-header"><a href="/blog/blog/articles/http-cache-01.html#http缓存分类" class="sidebar-link">Http缓存分类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/blog/articles/http-cache-01.html#强制缓存" class="sidebar-link">强制缓存</a></li><li class="sidebar-sub-header"><a href="/blog/blog/articles/http-cache-01.html#协商缓存" class="sidebar-link">协商缓存</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/blog/articles/http-cache-01.html#一些额外的东西" class="sidebar-link">一些额外的东西</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/blog/articles/http-cache-01.html#关于pragma" class="sidebar-link">关于Pragma</a></li><li class="sidebar-sub-header"><a href="/blog/blog/articles/http-cache-01.html#关于cache-control" class="sidebar-link">关于Cache-Control</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/blog/articles/http-cache-01.html#缓存的优先级" class="sidebar-link">缓存的优先级</a></li><li class="sidebar-sub-header"><a href="/blog/blog/articles/http-cache-01.html#结束语" class="sidebar-link">结束语</a></li></ul></li><li><a href="/blog/blog/articles/http-https-01.html" class="sidebar-link">关于https</a></li><li><a href="/blog/blog/articles/cdn-01.html" class="sidebar-link">聊聊CDN</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>安全</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>架构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其他</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="前端也要懂http缓存机制"><a href="#前端也要懂http缓存机制" class="header-anchor">#</a> 前端也要懂HTTP缓存机制</h1> <p>记得在我刚工作刚做项目的时候，将更改过的文件更新到服务器上，打开项目网站刷新后发现更改并没有生效，查来查去也没查出问题，之后师傅对我说，你清空一下浏览器缓存，在我清空浏览器缓存之后，奇迹发生了，一切都恢复正常，那时候我就很郁闷，缓存是个啥东西，于是最近终于抽空看了一下浏览器缓存这一方面的知识，在我总结之后，搭建后台进行了测试，加深我对缓存的理解。</p> <hr> <h2 id="http简介"><a href="#http简介" class="header-anchor">#</a> Http简介</h2> <p>浏览器和服务器之间通信是通过<code>HTTP</code>协议，<code>HTTP</code>协议永远都是客户端发起请求，服务器回送响应。模型如下：</p> <p><img src="https://s1.ax1x.com/2020/04/12/GOltde.png" alt="GOltde.png"></p> <p><code>HTTP</code>报文就是浏览器和服务器间通信时发送及响应的数据块。浏览器向服务器请求数据，发送请求(request)报文；服务器向浏览器返回数据，返回响应(response)报文。报文信息主要分为两部分：</p> <ol><li>报文头部：一些附加信息（cookie，缓存信息等），与缓存相关的规则信息，均包含在头部中</li> <li>数据主体部分：<code>HTTP</code>请求真正想要传输的数据内容</li></ol> <hr> <h2 id="后台搭建与测试"><a href="#后台搭建与测试" class="header-anchor">#</a> 后台搭建与测试</h2> <p>这里我自己用node.js搭建了一个后台，使用了<code>Express</code>框架，首先是不添加任何缓存信息头，代码如下：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>		<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">9527</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;!DOCTYPE html&gt;
			&lt;html lang=&quot;en&quot;&gt;
			&lt;head&gt;
				&lt;title&gt;Document&lt;/title&gt;
			&lt;/head&gt;
			&lt;body&gt;
				Http Cache Demo
				&lt;script src=&quot;/demo.js&quot;&gt;&lt;/script&gt;
			&lt;/body&gt;
			&lt;/html&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/demo.js'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token keyword">let</span> jsPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'./static/js/demo.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">let</span> cont <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>jsPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
			res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>cont<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">listen on </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>  <span class="token punctuation">;</span> 
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>可以看到请求结果如下：</p> <p><img src="https://s1.ax1x.com/2020/04/12/GOG6cn.png" alt="GOG6cn.png"></p> <p>请求过程大致为：</p> <ul><li>浏览器请求静态资源demo.js</li> <li>服务器读取磁盘文件demo.js，返给浏览器</li></ul> <p>如果这时候浏览器再次发出请求，或者说以后会有很多次这样的请求，那么这个过程就要一直重复。</p> <p>看得出来这种请求方式的流量与请求次数有关，同时，缺点也很明显：</p> <ul><li>浪费用户流量</li> <li>浪费服务器资源，服务器要读磁盘文件，然后发送文件到浏览器</li> <li>浏览器要等待js下载并且执行后才能渲染页面，影响用户体验</li></ul> <p>接下来，在请求头中添加上缓存信息，添加了缓存头信息之后又会是怎样的结果呢？</p> <hr> <h2 id="http缓存分类"><a href="#http缓存分类" class="header-anchor">#</a> Http缓存分类</h2> <p><code>Http</code>缓存可以分为两大类，强制缓存（也称强缓存）和协商缓存。两类缓存规则不同，强制缓存在缓存数据未失效的情况下，不需要再和服务器发生交互；而协商缓存，顾名思义，需要进行比较判断是否可以使用缓存。</p> <p>两类缓存规则可以同时存在，强制缓存优先级高于协商缓存，也就是说，当执行强制缓存的规则时，如果缓存生效，直接使用缓存，不再执行协商缓存规则。</p> <hr> <h3 id="强制缓存"><a href="#强制缓存" class="header-anchor">#</a> 强制缓存</h3> <p>强制缓存分为两种情况，<code>Expires</code>和<code>Cache-Control</code>。</p> <hr> <h4 id="expires"><a href="#expires" class="header-anchor">#</a> Expires</h4> <p><code>Expires</code>的值是服务器告诉浏览器的缓存过期时间（值为GMT时间，即格林尼治时间），即下一次请求时，如果浏览器端的当前时间还没有到达过期时间，则直接使用缓存数据。下面通过我的<code>Express</code>服务器来设置一下<code>Expires</code>响应头信息。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>		<span class="token comment">//其他代码...</span>
		<span class="token keyword">const</span> moment <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'moment'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/demo.js'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		  <span class="token keyword">let</span> jsPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'./static/js/demo.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		  <span class="token keyword">let</span> cont <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>jsPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
		  <span class="token comment">//这里缓存设置两分钟</span>
		  res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Expires'</span><span class="token punctuation">,</span> <span class="token function">getGLNZ</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>cont<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">function</span> <span class="token function">getGLNZ</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		  <span class="token keyword">return</span> <span class="token function">moment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">utc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'m'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'ddd, DD MMM YYYY HH:mm:ss'</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">' GMT'</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//其他代码...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>在demo.js中添加了一个<code>Expires</code>响应头，通过momentjs转换成格林尼治时间。第一次请求的时候还是会向服务器发起请求，同时会把过期时间和文件一起返回给我们，响应头中多了一个字段<code>Expires</code>，见下图：</p> <p><img src="https://s1.ax1x.com/2020/04/13/GXh0un.png" alt="GXh0un.png"></p> <p>不难发现<code>Expires</code>字段的时间与<code>Date</code>字段的时间相差了两分钟，也正好就是我们在响应头设置的两分钟的时间。</p> <p>当我们在这两分钟之内，刷新页面，奇迹发生了，看下图：</p> <p><img src="https://s1.ax1x.com/2020/04/13/GX51Ff.png" alt="GX51Ff.png"></p> <p>注意看红框标注的地方，可以看出文件是直接从缓存（memory cache）中读取的，并没有发起请求。我们在这边设置过期时间为两分钟，两分钟过后，已经超过了过期时间，刷新页面看到浏览器再次发送请求了。</p> <p>关于<code>Expires</code>，总结一下：</p> <p>虽然这种方式添加了缓存控制，节省流量，但是还是有以下几个问题的：</p> <ul><li>由于浏览器时间和服务器时间不同步，如果浏览器设置了一个很后的时间，过期时间一直没有用</li> <li>缓存过期后，不管文件有没有发生变化，服务器都会再次读取文件返回给浏览器</li></ul> <p>不过<code>Expires</code> 是<code>HTTP 1.0</code>的东西，现在浏览器均默认使用<code>HTTP 1.1</code>，所以它的作用基本忽略。</p> <hr> <h4 id="cache-control"><a href="#cache-control" class="header-anchor">#</a> Cache-Control</h4> <p>针对浏览器和服务器时间不同步，加入了新的缓存方案。这次服务器不是直接告诉浏览器过期时间，而是告诉一个相对时间，如Cache-Control=10秒，意思是10秒内，直接使用浏览器缓存。下面我将会在响应头中写入<code>Cache-Control</code>字段，时间设置为120秒：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>		<span class="token comment">//其他代码...</span>
		app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/demo.js'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		  <span class="token keyword">let</span> jsPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'./static/js/demo.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		  <span class="token keyword">let</span> cont <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>jsPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
		  <span class="token comment">//这里缓存设置两分钟</span>
		  res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Cache-Control'</span><span class="token punctuation">,</span> <span class="token string">'public,max-age=120'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>cont<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//其他代码...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>然后刷新页面，可以看到响应头中多了<code>Cache-Control</code>字段：</p> <p><img src="https://s1.ax1x.com/2020/04/13/Gji3Se.png" alt="Gji3Se.png"></p> <p>在两分钟之内，刷新页面，查看请求数据：</p> <p><img src="https://s1.ax1x.com/2020/04/13/GjiyOs.png" alt="GjiyOs.png"></p> <p>由于之前我们设置了响应头字段<code>Cache-Control</code>，时间为120秒，所以在这120秒之内刷新页面，文件还是直接从缓存中读取。</p> <p>关于<code>Cache-Control</code>，总结一下：</p> <ul><li>设置的时间为相对时间，有效的解决了浏览器和服务器时间不一致的问题</li> <li>缓存过期后，不管文件有没有发生变化，服务器都会再次读取文件返回给浏览器</li></ul> <hr> <h3 id="协商缓存"><a href="#协商缓存" class="header-anchor">#</a> 协商缓存</h3> <p>强制缓存的弊端很明显，即每次都是根据时间来判断缓存是否过期；但是当到达过期时间后，如果文件没有改动，再次去获取文件就有点浪费服务器的资源了。这里就引出了协商缓存，协商缓存就是浏览器给服务器发送请求，服务器来判断缓存资源是否可用，如果可用，则告诉浏览器直接读取缓存资源，如果不可用，则服务器重新读取资源返回给浏览器。</p> <p>协商缓存主要有两组报文结合使用：</p> <ol><li><code>Last-Modified</code>和<code>If-Modified-Since</code></li> <li><code>ETag</code>和<code>If-None-Match</code></li></ol> <p>这里引用别人的一张图：</p> <p><img src="https://s1.ax1x.com/2020/04/13/GjkhM4.jpg" alt="GjkhM4.jpg"></p> <p>看起来可能有点复杂，再继续往下一点一点分析。</p> <hr> <h4 id="last-modified"><a href="#last-modified" class="header-anchor">#</a> Last-Modified</h4> <p><code>Last-Modified</code>即上次修改时间。为了节省服务器的资源，再次改进方案。浏览器和服务器协商，服务器每次返回文件的同时，告诉浏览器文件在服务器上最近的修改时间。请求过程如下：</p> <ul><li>浏览器请求静态资源demo.js</li> <li>服务器读取磁盘文件demo.js，返给浏览器，同时带上文件上次修改时间 <code>Last-Modified</code>（GMT标准格式）</li> <li>当浏览器上的缓存文件过期时，浏览器带上请求头<code>If-Modified-Since</code>（等于上一次请求的<code>Last-Modified</code>）请求服务器</li> <li>服务器比较请求头里的<code>If-Modified-Since</code>和文件的上次修改时间。如果一致就继续使用本地缓存（304），如果不一致就再次返回文件内容和<code>Last-Modified</code></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>		<span class="token comment">//其他代码...</span>
		app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/demo.js'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token keyword">let</span> jsPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'./static/js/demo.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">let</span> cont <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>jsPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">let</span> status <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>jsPath<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">let</span> lastModified <span class="token operator">=</span> status<span class="token punctuation">.</span>mtime<span class="token punctuation">.</span><span class="token function">toUTCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>lastModified <span class="token operator">===</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'if-modified-since'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">304</span><span class="token punctuation">,</span> <span class="token string">'Not Modified'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Cache-Control'</span><span class="token punctuation">,</span> <span class="token string">'public,max-age=5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Last-Modified'</span><span class="token punctuation">,</span> lastModified<span class="token punctuation">)</span><span class="token punctuation">;</span>
				res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">'OK'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>cont<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//其他代码...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>下面来看第一次请求的结果：</p> <p><img src="https://s1.ax1x.com/2020/04/13/GjV0MD.png" alt="GjV0MD.png"></p> <p>再次刷新页面，再查看请求结果：</p> <p><img src="https://s1.ax1x.com/2020/04/13/GjV2JP.png" alt="GjV2JP.png"></p> <p>关于<code>Last-Modified</code>，总结一下：</p> <p>虽然这个方案比前面的方案有了进一步的优化，浏览器检测文件是否有修改，如果没有变化就不再发送文件，但是还是有以下缺点：</p> <ul><li>由于<code>Last-Modified</code>修改时间是GMT时间，只能精确到秒，如果文件在1秒内有多次改动，服务器并不知道文件有改动，浏览器拿不到最新的文件</li> <li>如果服务器上文件被多次修改了但是内容却没有发生改变，服务器需要再次重新返回文件</li></ul> <hr> <h4 id="etag"><a href="#etag" class="header-anchor">#</a> ETag</h4> <p>为了解决文件修改时间不精确带来的问题，服务器和浏览器再次协商，这次不返回时间，返回文件的唯一标识<code>ETag</code>。只有当文件内容改变时，<code>ETag</code>才改变。请求过程如下：</p> <ul><li>浏览器请求静态资源demo.js</li> <li>服务器读取磁盘文件demo.js，返给浏览器，同时带上文件的唯一标识ETag</li> <li>当浏览器上的缓存文件过期时，浏览器带上请求头<code>If-None-Match</code>（等于上一次请求的<code>ETag</code>）请求服务器</li> <li>服务器比较请求头里的<code>If-None-Match</code>和文件的<code>ETag</code>。如果一致就继续使用本地缓存（304），如果不一致就再次返回文件内容和<code>ETag</code></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>		<span class="token comment">//其他代码...</span>
		<span class="token keyword">const</span> md5 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'md5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/demo.js'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		  <span class="token keyword">let</span> jsPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'./static/js/demo.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		  <span class="token keyword">let</span> cont <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>jsPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
		  <span class="token keyword">let</span> etag <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span>cont<span class="token punctuation">)</span><span class="token punctuation">;</span>

		  <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'if-none-match'</span><span class="token punctuation">]</span> <span class="token operator">===</span> etag<span class="token punctuation">)</span><span class="token punctuation">{</span>
			res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">304</span><span class="token punctuation">,</span> <span class="token string">'Not Modified'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'ETag'</span><span class="token punctuation">,</span> etag<span class="token punctuation">)</span><span class="token punctuation">;</span>
			res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">'OK'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>cont<span class="token punctuation">)</span><span class="token punctuation">;</span>
		  <span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//其他代码...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>下面来看第一次请求的结果：</p> <p><img src="https://s1.ax1x.com/2020/04/13/GjNKKJ.png" alt="GjNKKJ.png"></p> <p>再次刷新页面，再查看请求结果：</p> <p><img src="https://s1.ax1x.com/2020/04/13/GjNNxe.png" alt="GjNNxe.png"></p> <p>关于<code>ETag</code>，总结一下：</p> <p>这种策略和之前的相比，确实是有了不少的优化，我个人认为是一种不错的缓存策略。</p> <hr> <h2 id="一些额外的东西"><a href="#一些额外的东西" class="header-anchor">#</a> 一些额外的东西</h2> <p>在报文头的表格中我们可以看到有一个字段叫<code>Pragma</code>，这是一段尘封的历史...</p> <p>在“遥远的”<code>http1.0</code>时代，给客户端设定缓存方式可通过两个字段，<code>Pragma</code>和<code>Expires</code>。虽然这两个字段早可抛弃，但为了做<code>http</code>协议的向下兼容，还是可以看到很多网站依旧会带上这两个字段。</p> <hr> <h3 id="关于pragma"><a href="#关于pragma" class="header-anchor">#</a> 关于Pragma</h3> <p>当该字段值为<code>no-cache</code>的时候，会告诉浏览器不要对该资源缓存，即每次都得向服务器发一次请求才行。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>		res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Pragma'</span><span class="token punctuation">,</span> <span class="token string">'no-cache'</span><span class="token punctuation">)</span> <span class="token comment">//禁止缓存</span>
		res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Cache-Control'</span><span class="token punctuation">,</span> <span class="token string">'public,max-age=120'</span><span class="token punctuation">)</span> <span class="token comment">//2分钟</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>通过<code>Pragma</code>来禁止缓存，通过<code>Cache-Control</code>设置两分钟缓存，但是重新访问我们会发现浏览器会再次发起一次请求，说明了<code>Pragma</code>的优先级高于<code>Cache-Control</code>。</p> <hr> <h3 id="关于cache-control"><a href="#关于cache-control" class="header-anchor">#</a> 关于Cache-Control</h3> <p>我们看到<code>Cache-Control</code>中有一个属性是<code>public</code>，那么这代表了什么意思呢？其实<code>Cache-Control</code>不光有<code>max-age</code>，它常见的取值<code>private</code>、<code>public</code>、<code>no-cache</code>、<code>max-age</code>，<code>no-store</code>，默认值为<code>private</code>，各个取值的含义如下：</p> <ul><li>private: 客户端可以缓存</li> <li>public: 客户端和代理服务器都可缓存</li> <li>max-age=xxx: 缓存的内容将在 xxx 秒后失效</li> <li>no-cache: 需要使用对比缓存来验证缓存数据</li> <li>no-store: 所有内容都不会缓存，强制缓存，对比缓存都不会触发</li></ul> <p>所以我们在刷新页面的时候，如果只按<code>F5</code>只是单纯的发送请求，按<code>Ctrl+F5</code>会发现请求头上多了两个字段<code>Pragma: no-cache</code>和<code>Cache-Control: no-cache</code>。</p> <hr> <h2 id="缓存的优先级"><a href="#缓存的优先级" class="header-anchor">#</a> 缓存的优先级</h2> <p>上面我们说过强制缓存的优先级高于协商缓存，<code>Pragma</code>的优先级高于<code>Cache-Control</code>，那么其他缓存的优先级顺序怎么样呢？网上查阅了资料得出以下顺序：</p> <p><strong>Pragma &gt; Cache-Control &gt; Expires &gt; ETag &gt; Last-Modified</strong></p> <hr> <h2 id="结束语"><a href="#结束语" class="header-anchor">#</a> 结束语</h2> <p>以上就是关于<code>http</code>缓存的一些理解，从一开始对<code>http</code>缓存的一无所知，到现在终于对<code>http</code>缓存有了一定的理解，用好<code>http</code>缓存，对于一些项目的优化有了不少的提升，这也确实会对用户体验有很大的改善，但是缓存也有它的弊端，如果缓存没设置恰当，有时候资源更新了，却还使用了旧的资源，这就会带来一些不可预期的问题。如果本文中有说的不正确的地方，欢迎大佬鞭策!</p> <p><strong>参考资料：</strong></p> <p><a href="https://zhuanlan.zhihu.com/p/100890757" target="_blank" rel="noopener noreferrer">知乎-前端也要懂Http缓存机制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/17/2021, 8:14:21 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/blog/articles/browser-rendering-principle-01.html" class="prev">
        浏览器渲染原理
      </a></span> <span class="next"><a href="/blog/blog/articles/http-https-01.html">
        关于https
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.591f29a6.js" defer></script><script src="/blog/assets/js/2.74b5bf19.js" defer></script><script src="/blog/assets/js/18.24ff51a2.js" defer></script>
  </body>
</html>
